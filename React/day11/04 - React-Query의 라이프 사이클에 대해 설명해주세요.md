# React-Query의 라이프 사이클에 대해 설명해주세요.

<br />

> 목차

> [동우](#동우)

> [은지](#은지)

> [지연](#지연)

> [규란](규란)

<br />

### 동우

- fresh, fetching, stale, inactive, delete 다섯가지의 상태가 있고,
- fetching 상태는 서버에 상태를 요청중인 쿼리를 말한다.
- fresh상태는 staleTime이 만료되지 않은 쿼리를 말합니다, options의 staleTime 동안 해당 상태로 유지된다. 컴포넌트가 마운트되거나 업데이트 되어도 데이터를 다시 요청하지 않고, 캐싱된 데이터를 반환한다.
- stale 상태는 staleTime이 만료된 쿼리를 말합니다.. 컴포넌트가 마운트되거나 업데이트 되면 데이터를 재요청하여queryKey 배열의 값을 업데이트 합니다. 이 때에도 캐싱된 데이터가 있다면 재요청한 데이터를 가져오는 동안에 캐싱되어 있는 데이터를 보여준다.
- inactive 상태는 쿼리가 사용된 컴포넌트가 언마운트 되었을 때, cacheTime 동안 캐시에 남아있는 상태를 말합니다. cacheTime이 다 지나면 해당 데이터는 가비지 컬렉션의 대상이 되어 메모리에서 제거됩니다.
- delete 상태는 가비지 컬렉터에 의해 캐시에서 데이터가 제거된 상태를 말한다.

<br />

### 은지

React-Query는 다양한 라이프 사이클을 가지고 있습니다.

1. A 쿼리 인스턴스가 **mount되면 해당 쿼리를 서버에 요청한다.**
2. 네트워크에서 데이터를 fetch 하고 **A 라는 query key로 캐싱함**
3. 이 데이터는 fresh 상태에서 **staleTime (기본값 0) 이후 stale 상태로 변경됨**
4. A 쿼리 인스턴스가 unmount 됨
5. 캐시는 **cacheTime (기본값 5분) 만큼 유지**되다가 가비지 콜렉터로 수집됨
6. 만일 cacheTime 이 지나기 전에 A 쿼리 인스턴스가 **새롭게 mount 되면, fetch 가 실행되고, fresh 한 값을 가져오는 동안 캐시 데이터를 보여줌.**

<br />

### 지연

- 쿼리 인스턴스가 mount → 네트워크에서 데이터를 fetch하고 query key로 캐싱 → 해당 데이터는 fresh 상태에서 stateTime 이후 stale 상태로 변경 → 쿼리 인스턴스가 unmount → cacheTime만큼 유지된 캐시는 이후 가비지 콜렉터로 수집됨 → 만일 cacheTime 만료 전 쿼리 인스턴스가 새롭게 mount되면 앞선 모든 동작이 실행되는 동안 캐시된 데이터를 보여줌

<br />

### 규란

#### 상태

1. fetching : 데이터를 요청한 상태이다.

2. fresh : 데이터가 프레시한, 만료되지 않은 상태이다.

   - 컴포넌트의 상태가 변경되더라도 데이터를 다시 fetching 하지 않는다.
   - 새로고침 시, 다시 fetching 한다.

3. stale : 최신화가 필요한, 데이터가 오래되었음을 의미하는 상태이다.

   - 다른 설정을 하지 않으면 리액트쿼리는 기본적으로 캐시된 데이터를 stale한 상태로 여긴다. 받아온 순간에도 다른 유저에 의해 추가, 수정, 삭제될 수 있기 때문이다.
   - staleTime 동안 데이터는 fresh한 상태이다가 이후 stale한 상태로 바뀐다. (default - 0)
   - 컴포넌트가 마운트, 업데이트되면 데이터를 다시 fetching 한다.

4. inactive : 데이터가 사용되지 않는 상태를 의미한다.

   - cacheTime이 지나면 가비지 콜렉터에 의해 제거된다.
   - 쿼리 인스턴스가 unmount될 때 데이터가 inactive 상태로 변경

5. delete : 가비지 콜렉터에 의해 캐시에서 제거된 상태

#### 라이프사이클

1. 쿼리 인스턴스가 mount
2. 데이터를 fetching한 후에 특정 query key로 캐싱
3. 데이터가 fresh 상태였다가 staleTime 이후에 stale 상태로 변경
4. 쿼리 인스턴스가 unmount
5. cacheTime 동안 데이터가 캐싱되고, 이후에 가비지 컬렉터에 의해 캐시에서 제거

---

<br />

### 꼬리 질문 모음

- **꼬리 질문 1 : 라이프 사이크 별 상태의 개념에 대해 설명해주세요.**

  ⇒ fetching : 데이터 요청 상태  
  ⇒ fresh : 데이터가 만료되지 않은 상태  
  ⇒ stale : 데이터가 만료된 상태  
  ⇒ inactive : 사용하지 않는 상태  
  ⇒ delete : 가비지 콜렉터에 의해 캐시에서 제거된 상태
